name: ğŸš€ Deploy CajÃ¡ Website to Hostinger

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      deploy_message:
        description: 'Deploy message'
        required: false
        default: 'Manual deploy triggered'

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
    
    - name: ğŸ”‘ Setup SSH Connection
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.HOSTINGER_SSH_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -t rsa srv1845.hstgr.io >> ~/.ssh/known_hosts
        echo "âœ… SSH Key configured"
    
    - name: ğŸ§ª Test SSH Connection
      run: |
        ssh -i ~/.ssh/id_rsa u921347543@srv1845.hstgr.io "echo 'SSH Connection successful!'"
    
    - name: ğŸ—„ï¸ Backup Existing Files
      run: |
        ssh -i ~/.ssh/id_rsa u921347543@srv1845.hstgr.io "
          cd /home/u921347543/public_html
          if [ -f index.html ]; then
            mkdir -p backup_\$(date +%Y%m%d_%H%M%S)
            cp -r *.html *.css *.js *.php config admin backup_\$(date +%Y%m%d_%H%M%S)/ 2>/dev/null || true
            echo 'âœ… Backup created'
          fi
        "
    
    - name: ğŸ“¤ Deploy Main Files
      run: |
        echo "ğŸ“‹ Uploading main website files..."
        scp -i ~/.ssh/id_rsa index.html u921347543@srv1845.hstgr.io:/home/u921347543/public_html/
        scp -i ~/.ssh/id_rsa style.css u921347543@srv1845.hstgr.io:/home/u921347543/public_html/
        scp -i ~/.ssh/id_rsa script.js u921347543@srv1845.hstgr.io:/home/u921347543/public_html/
        scp -i ~/.ssh/id_rsa contact.php u921347543@srv1845.hstgr.io:/home/u921347543/public_html/
        echo "âœ… Main files uploaded"
    
    - name: âš™ï¸ Deploy Configuration
      run: |
        echo "ğŸ“Š Uploading database configuration..."
        ssh -i ~/.ssh/id_rsa u921347543@srv1845.hstgr.io "mkdir -p /home/u921347543/public_html/config"
        scp -i ~/.ssh/id_rsa config/database.php u921347543@srv1845.hstgr.io:/home/u921347543/public_html/config/
        echo "âœ… Database config uploaded"
    
    - name: ğŸ‘¨â€ğŸ’¼ Deploy Admin Panel
      run: |
        echo "ğŸ” Uploading admin panel..."
        ssh -i ~/.ssh/id_rsa u921347543@srv1845.hstgr.io "mkdir -p /home/u921347543/public_html/admin"
        scp -i ~/.ssh/id_rsa admin/*.php u921347543@srv1845.hstgr.io:/home/u921347543/public_html/admin/
        echo "âœ… Admin panel uploaded"
    
    - name: ğŸ”§ Set File Permissions
      run: |
        ssh -i ~/.ssh/id_rsa u921347543@srv1845.hstgr.io "
          cd /home/u921347543/public_html
          chmod 644 *.html *.css *.js *.php 2>/dev/null || true
          chmod 644 config/*.php 2>/dev/null || true
          chmod 644 admin/*.php 2>/dev/null || true
          chmod 755 config admin 2>/dev/null || true
          echo 'âœ… Permissions configured'
        "
    
    - name: ğŸ§ª Verify Deployment
      run: |
        echo "ğŸ” Verifying files on server..."
        ssh -i ~/.ssh/id_rsa u921347543@srv1845.hstgr.io "
          cd /home/u921347543/public_html
          echo 'ğŸ“ Main files:'
          ls -la *.html *.css *.js *.php 2>/dev/null || echo 'No main files found'
          echo 'ğŸ“ Config:'
          ls -la config/ 2>/dev/null || echo 'Config folder missing'
          echo 'ğŸ“ Admin:'
          ls -la admin/ 2>/dev/null || echo 'Admin folder missing'
        "
    
    - name: ğŸ‰ Deployment Success
      run: |
        echo "ğŸ‰ DEPLOY COMPLETED SUCCESSFULLY!"
        echo "=================================="
        echo ""
        echo "âœ… CajÃ¡ Website Features Deployed:"
        echo "   ğŸ¥­ Widget 'Ajuda?' with CajÃ¡ icon"
        echo "   ğŸŸ¡ Golden brand colors applied"
        echo "   ğŸ“± Interactive menu (WhatsApp + Form + Phone)"
        echo "   ğŸ“Š Database connected: u921347543_sitecaja"
        echo "   ğŸ‘¨â€ğŸ’¼ Admin panel: /admin/ (admin/cajait2025!)"
        echo ""
        echo "ğŸ§ª Test your website:"
        echo "   ğŸŒ Site: https://your-domain.com"
        echo "   ğŸ’¬ Widget: Check 'Ajuda?' button (bottom-right)"
        echo "   ğŸ” Admin: https://your-domain.com/admin/"
        echo ""
        echo "ğŸ”¥ Professional CajÃ¡ website is now LIVE!"